import numpy as np
import matplotlib.pyplot as plt
from tenacity import AttemptManager

# 1/sqrt(min(m,n)), 1. lr = 0.01
K1_M500_RS005 = [1.6060421530218225, 1.5943100380122202, 1.5827409181903003, 1.5702259568534427, 1.5560613998120092, 1.539802544939682, 1.5211822427236217, 1.500051269678313, 1.4763498754353426, 1.4500854668380863, 1.4213141568669185, 1.3901411768333019, 1.3566978193481534, 1.3211439036506527, 1.2836463101904618, 1.24439114889745, 1.203574920758194, 1.1613984035036902, 1.1180791960586292, 1.0738342062059545, 1.0288723547192036, 0.9834184655497581, 0.9377095297255854, 0.8919692864392524, 0.8463991795834471, 0.8011931937028005, 0.756545155553055, 0.7126298315488402, 0.6696256990461906, 0.6276832705629606, 0.5869306200132777, 0.5474921428163275, 0.509468906835786, 0.47295325740222344, 0.4380113491863916, 0.40468020623867723, 0.37298208104754443, 0.34291660242569033, 0.3144583939983018, 0.2875671706713369, 0.26220823962888584, 0.23835646892112605, 0.2159877605623489, 0.1950865827269339, 0.17564056108347306, 0.15764187112826092, 0.14107514125885126, 0.12590512053615835, 0.1120879015226532, 0.0995758808947079]

K3_M500_RS005 = [1.565568362011469, 1.5110578209833814, 1.4333820230215222, 1.3302265465309078, 1.2050451059720977, 1.0651875672054159, 0.9197566204484727, 0.7775141130214734, 0.6453644610626567, 0.527232888939928, 0.4247207019617818, 0.3379488602605955, 0.266082390798081, 0.20736056039511944, 0.15998513001450135, 0.12205313961884959, 0.09145764949948464, 0.06642878948438005, 0.04597397625735606, 0.029701968257189106, 0.017614294472476987, 0.009874964874369065, 0.005911691397006282, 0.004299169393857817, 0.0037505568132607664, 0.003577793305963287, 0.0035232499762744545, 0.003505988851890937, 0.00350058385412374, 0.003499008293931278, 0.0034987343284974574, 0.0034988983131500158, 0.003499215270971547, 0.0034995880290645868, 0.003499981732553565, 0.0035003835855288348, 0.003500789183363259, 0.003501196551740114, 0.0035016048763169155, 0.0035020137471192055, 0.0035024229039097568, 0.0035028321901629136, 0.0035032415983060543, 0.003503651119032901, 0.0035040607451738695, 0.003504470464825677, 0.003504880270960537, 0.0035052901594312762, 0.0035057001277739863, 0.0035061101745062703]

K5_M500_RS005 = [1.5226610108802903, 1.3849990952252218, 1.1800042282250742, 0.9378425659741976, 0.6990991405299212, 0.49226781375440515, 0.32958975756526404, 0.21205515211455603, 0.1322233004281499, 0.08080512305422617, 0.05148088088133057, 0.0364043328578902, 0.0290191439078164, 0.024083010013997097, 0.018271733981586654, 0.01162688306537925, 0.006952732969999507, 0.005080693932534494, 0.004545738850201571, 0.004407299060584525, 0.004372001551421755, 0.004363619687355589, 0.004362209382531502, 0.004362665148004829, 0.004363627771908867, 0.004364734540837827, 0.004365884642765712, 0.004367049460167355, 0.004368220278046238, 0.004369393942135394, 0.004370569069585212, 0.0043717451066906, 0.0043729218299834284, 0.004374098787255932, 0.004375276085520901, 0.004376453796435055, 0.004377631959598067, 0.004378810506929288, 0.004379989560548128, 0.004381169119042799, 0.004382349141539715, 0.004383529485676381, 0.004384710321081492, 0.004385891632300126, 0.004387073387033514, 0.004388255583356045, 0.004389438090810033, 0.004390620989776035, 0.0043918042805988385, 0.0043929877387040885]

K10_M500_RS005 = [1.352091884056041, 0.9008370971790556, 0.505100612840192, 0.26459431264992966, 0.1287499682806631, 0.06961034887575823, 0.030616925884387653, 0.00877612782433006, 0.006030452813807215, 0.005870679495172417, 0.005858485133873671, 0.005859698874824226, 0.005862706657163423, 0.005866036618206627, 0.005869437716944017, 0.005872856435784708, 0.005876278045466636, 0.005879699957680622, 0.00588312288145492, 0.005886547203144665, 0.005889972813445, 0.005893399222621277, 0.005896825798884688, 0.005900252878793233, 0.005903680344852953, 0.0059071081413896815, 0.00591053542017368, 0.00591396236278635, 0.005917389619938665, 0.005920817683184873, 0.005924244994994836, 0.005927671062823594, 0.005931095290402099, 0.005934517568715053, 0.0059379388240549166, 0.005941360500156489, 0.005944781770502264, 0.005948203186111012, 0.005951624559582228, 0.005955045659695243, 0.005958467249719093, 0.005961889378560721, 0.005965311964573409, 0.005968734700375219, 0.005972157841896925, 0.005975580625194891, 0.005979002728746898, 0.005982423371587091, 0.005985841521420862, 0.0059892587496563204]

K10_M500_RS005_LR002 = [1.0194460306322, 0.40092480894164084, 0.14232495860116423, 0.05124475501120388, 0.01835728108478291, 0.006965114283735603, 0.006611606512357378, 0.006614728678187295, 0.006620442752945514, 0.006626072564318295, 0.0066316662819945575, 0.006637244690890993, 0.006642811585197196, 0.006648368658091177, 0.0066539162455546905, 0.006659450952185601, 0.006664974452613751, 0.006670486483462535, 0.006675984530017573, 0.006681470199357041, 0.006686944416346003, 0.006692406279888171, 0.0066978544076118215, 0.006703291108896679, 0.006708716274302816, 0.006714125709422914, 0.006719520424004454, 0.006724902943330724, 0.0067302730704730885, 0.006735630420550297, 0.0067409732402306105, 0.0067462996869451786, 0.006751612756420502, 0.006756908609910249, 0.006762184586303849, 0.006767446169254262, 0.006772692173336103, 0.006777924975171967, 0.006783141070895924, 0.006788340801306585, 0.006793521648338405, 0.00679868513072528, 0.0068038334349389325, 0.006808966540242488, 0.0068140820654598614, 0.006819179870880909, 0.006824256467201344, 0.006829316687919583, 0.006834359714262082, 0.006839386466191966]

# changed rank to 2r
# K10_M500_RS005_rank = [1.0746520549886593, 0.4707169947315613, 0.10309798705980099, 0.0073659398480340876, 0.0009728405059648714, 0.0007868318318140877, 0.000779365992428401, 0.0007790598486556301, 0.0007790661819567228, 0.0007790810700220937, 0.0007790949343291689, 0.000779108462674383, 0.0007791219271615101, 0.0007791353899135854, 0.0007791488641645549, 0.0007791623527744518, 0.0007791758564090888, 0.0007791893752631776, 0.0007792029094287686, 0.0007792164589754287, 0.0007792300239679558, 0.0007792436044703441, 0.000779257200546677, 0.000779270812261334, 0.0007792844396790358, 0.0007792980828648577, 0.0007793117418842354, 0.0007793254168029641, 0.0007793391076872041, 0.0007793528146034782, 0.0007793665376186769, 0.0007793802768000591, 0.0007793940322152529, 0.0007794078039322582, 0.0007794215920194497, 0.000779435396545575, 0.0007794492175797601, 0.0007794630551915097, 0.0007794769094507083, 0.0007794907804276228, 0.0007795046681929051, 0.0007795185728175916, 0.0007795324943731069, 0.0007795464329312652, 0.0007795603885642719, 0.0007795743613447253, 0.0007795883513456185, 0.0007796023586403418, 0.0007796163833026837, 0.0007796304254068335]

# APGM:
APGM_M500 = [0.4385698467858011, 0.3747945949468824, 0.30975952363780773, 0.24878418777706615, 0.19498712368241958, 0.14957281087083568, 0.1125425787163406, 0.08326612677001495, 0.06079241980861278, 0.04405188212645274, 0.031963166314181043, 0.02351471186748922, 0.01779989395652983, 0.01406870780725848, 0.011716026525169159, 0.010288060310455793, 0.009450537205209731, 0.008975359297965373, 0.008714262529550952, 0.008573549076687394, 0.008498903587539589, 0.008459700315868313, 0.00843893766903132, 0.008427780223466467, 0.008421677852232093, 0.00841826797482556, 0.008416317446071544, 0.008415175634085736, 0.008414495163757894, 0.008414085464923577, 0.00841383738592683, 0.008413686117034708, 0.008413593201831084, 0.008413535786962134, 0.0084135001327407, 0.008413477897890754, 0.00841346397962896, 0.00841345523745582, 0.008413449728988463, 0.0084134462477588, 0.008413444041534462, 0.008413442639646914, 0.00841344174662923, 0.008413441176423394, 0.008413440811522904, 0.008413440577510752, 0.008413440427135089, 0.008413440330318517, 0.008413440267870878, 0.008413440227521416]

ALM_M500 = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.3636332511328895, 0.018338296827646476, 0.018115722432797493, 0.018226036115291822, 0.018780616112883678, 0.026388477950941295, 0.03194978902386243, 0.032835164087907154, 0.032952346479839786, 0.032967014943561954, 0.032968878124096795, 0.03296911718304227, 0.032969150018718335, 0.032969152433033416, 0.03296915289211468, 0.032969152896439854, 0.03296915291955682, 0.03296915291955683, 0.03296915291955683, 0.03296915291955682, 0.03296915291955682, 0.03296915291955683, 0.03296915291955682, 0.032969152919556814, 0.03296915291955682, 0.03296915291955683, 0.03296915291955682, 0.03296915291955682, 0.03296915291955683, 0.03296915291955682, 0.03296915291955682, 0.03296915291955683, 0.032969152919556814, 0.03296915291955682, 0.03296915291955683, 0.03296915291955682, 0.03296915291955683, 0.03296915291955682, 0.03296915291955682, 0.03296915291955682, 0.03296915291955682, 0.03296915291955682, 0.03296915291955683]

CF_PCA_M500_LR1 = [1.173479546340534, 1.008148732581205, 0.6481921546005436, 0.38223443049614153, 0.190427577211031, 0.08213101938584799, 0.028855429096750908, 0.008641583024207027, 0.0033515719625134585, 0.0024652095569588045, 0.002365919445317222, 0.002357561999206755, 0.002356872889387438, 0.0023567681878922542, 0.0023567496790410404, 0.002356746125145276, 0.002356745313825523, 0.0023567450141229237, 0.0023567448083048983, 0.0023567446169524414, 0.002356744424665083, 0.0023567442283239214, 0.0023567440272123366, 0.0023567438210968243, 0.002356743609844048, 0.002356743393341339, 0.0023567431714793196, 0.00235674294414787, 0.0023567427112351122, 0.0023567424726271334, 0.002356742228207876, 0.002356741977859087, 0.00235674172146027, 0.0023567414588886414, 0.002356741190019095, 0.0023567409147241506, 0.002356740632873918, 0.0023567403443360484, 0.002356740048975693, 0.002356739746655452, 0.002356739437235337, 0.0023567391205727125, 0.002356738796522261, 0.00235673846493592, 0.002356738125662845, 0.0023567377785493485, 0.002356737423438855, 0.0023567370601718486, 0.0023567366885858137, 0.0023567363085151873]


K10_M1000_RS005_LR002 = [1.2751671704692116, 0.6010035860379118, 0.19008272198864157, 0.05955778197614436, 0.024850672819848242, 0.006636852355996696, 0.00614088358559189, 0.006145633780173786, 0.006151304133286259, 0.006156940037948068, 0.006162568985599329, 0.00616819346474128, 0.0061738137639414615, 0.006179430626100513, 0.006185041977778707, 0.006190648311221895, 0.006196252418050365, 0.0062018522407021395, 0.00620744908750201, 0.006213040868313332, 0.00621862984188144, 0.006224215866919848, 0.006229799002580587, 0.006235378252733702, 0.006240956160198746, 0.006246535124108151, 0.0062521145801158065, 0.0062576941579690565, 0.006263271647589064, 0.006268847975410366, 0.006274423406535527, 0.006279999283521695, 0.00628557541080559, 0.006291150698500623, 0.006296726342656703, 0.006302302625955623, 0.0063078786353952835, 0.00631345462206188, 0.0063190286445039935, 0.006324601647466714, 0.006330174763489941, 0.0063357487139003126, 0.0063413223081600955, 0.006346894770613835, 0.00635246418234584, 0.006358027828148162, 0.006363589321360729, 0.006369146974224809, 0.006374702069857954, 0.00638025283211602]

APGM_M1000 = [0.4386946117752156, 0.3747317631228289, 0.3093796149374174, 0.24796606664194115, 0.19368297081743646, 0.1478273896151515, 0.11046964343395341, 0.08102046426501099, 0.058538392071992774, 0.04192204758703242, 0.03004420442322227, 0.02185593961904019, 0.01642312349423364, 0.012963705195613224, 0.010856422039883264, 0.009628101330663988, 0.008943304865999683, 0.008577089470457246, 0.008387941384756967, 0.008292707131482906, 0.008245721505656617, 0.00822262491756705, 0.008211194413753843, 0.008205358521783196, 0.00820229418749211, 0.008200641920356636, 0.008199729217637407, 0.008199215405779291, 0.008198921693692553, 0.008198753125249843, 0.008198656082890403, 0.0081985997946412, 0.008198566932242338, 0.00819854763562627, 0.008198536245074592, 0.008198529488759092, 0.008198525463373418, 0.008198523055248411, 0.008198521609205714, 0.008198520737868005, 0.008198520211145248, 0.008198519891795333, 0.008198519697640187, 0.008198519579296343, 0.008198519506989297, 0.008198519462711544, 0.008198519435541196, 0.008198519418836007, 0.00819851940854624, 0.008198519402197457]

ALM_M1000 = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.37454205831364773, 0.018464437125698258, 0.018203667653733033, 0.018203667653733033, 0.018330111341020867, 0.02666589469888731, 0.03216000214713893, 0.033036674110357614, 0.03315339796326411, 0.03316828944515075, 0.033170162739754434, 0.03317039397956772, 0.03317042263075197, 0.03317042589177833, 0.033170426358514596, 0.033170426388277996, 0.033170426400896486, 0.03317042640381888, 0.033170426403818884, 0.033170426403818884, 0.03317042640381888, 0.03317042640381887, 0.033170426403818884, 0.033170426403818884, 0.03317042640381887, 0.03317042640381887, 0.033170426403818884, 0.03317042640381887, 0.03317042640381888, 0.03317042640381888, 0.03317042640381888, 0.03317042640381887, 0.033170426403818884, 0.033170426403818884, 0.03317042640381887, 0.033170426403818884, 0.03317042640381887, 0.033170426403818884, 0.03317042640381888, 0.03317042640381887, 0.033170426403818884, 0.033170426403818884, 0.03317042640381887, 0.03317042640381887]

CF_PCA_M1000_LR05 = [1.4903352674388508, 1.2155728988703691, 0.9137136339104474, 0.619923290224226, 0.37346123863905356, 0.19846343461801894, 0.081540206572335, 0.027681898394555086, 0.00790035299042117, 0.002941711675794782, 0.002236395359208991, 0.0021949732006853, 0.00219378704304488, 0.0021937497264268085, 0.0021937504835038875, 0.002193751104210687, 0.0021937512316490314, 0.0021937512271761974, 0.002193751193648078, 0.0021937511538884283, 0.002193751112518518, 0.002193751070420646, 0.0021937510277516923, 0.0021937509845342262, 0.0021937509407671607, 0.0021937508964454907, 0.0021937508515635917, 0.002193750806115721, 0.0021937507600960815, 0.002193750713498823, 0.0021937506663180398, 0.002193750618547771, 0.002193750570182001, 0.0021937505212146556, 0.002193750471639605, 0.002193750421450659, 0.0021937503706415716, 0.0021937503192060366, 0.0021937502671376895, 0.002193750214430104, 0.002193750161076794, 0.002193750107071214, 0.0021937500524067555, 0.0021937499970767467, 0.0021937499410744563, 0.0021937498843930844, 0.002193749827025775, 0.0021937497689655996, 0.002193749710205571, 0.0021937496507386314]

step = [i for i in range(len(K1_M500_RS005))]

# plt.figure(figsize=(8,5),dpi=200)
# plt.title("Different values of K (m,n = 500)")
# plt.xlabel("# Iterations")
# plt.ylabel("Relative err")
# plt.yscale('log')
# size=4
# plt.plot(step,K1_M500_RS005,marker='o',markersize=size,label='K=1')
# plt.plot(step,K3_M500_RS005,marker='o',markersize=size,label='K=3')
# plt.plot(step,K5_M500_RS005,marker='o',markersize=size,label='K=5')
# plt.plot(step,K10_M500_RS005,marker='o',markersize=size,label='K=10')
# plt.legend(loc=1,fontsize=14)
# plt.savefig("figures/differentK",bbox_inches='tight',dpi=300)



plt.figure(figsize=(8,5),dpi=300)
plt.title("Comparison of different RPCA algorithms")
plt.xlabel("# Iterations")
plt.ylabel("Relative err")
plt.yscale('log')
size=4
plt.plot(step,K10_M500_RS005_LR002,marker='o',markersize=size,label='DCF-PCA')
# plt.plot(step,K10_M500_RS005_rank,label='DCF-PCA unknown rank')
plt.plot(step,ALM_M500,marker='o',markersize=size,label='ALM')
plt.plot(step,APGM_M500,marker='o',markersize=size,label='APGM')
plt.plot(step,CF_PCA_M500_LR1,marker='o',markersize=size,label='CF-PCA')
plt.legend(loc=1,fontsize=14)
plt.savefig("figures/M500",bbox_inches='tight',dpi=300)

# plt.figure(figsize=(8,5),dpi=300)
# plt.title("Comparison of different RPCA algorithms")
# plt.xlabel("# Iterations")
# plt.ylabel("Relative err")
# plt.yscale('log')
# size=4
# plt.plot(step, K10_M1000_RS005_LR002,marker='o',markersize=size,label='DCF-PCA')
# # plt.plot(step,K10_M500_RS005_rank,label='DCF-PCA unknown rank')
# plt.plot(step,ALM_M1000,marker='o',markersize=size,label='ALM')
# plt.plot(step,APGM_M1000,marker='o',markersize=size,label='APGM')
# plt.plot(step,CF_PCA_M1000_LR05,marker='o',markersize=size,label='CF-PCA')
# plt.legend(loc=1,fontsize=14)
# plt.savefig("figures/M1000",bbox_inches='tight',dpi=300)